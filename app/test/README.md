# Semi-automated testing of FC app

## Set up environment
Prerequisites: Docker and conda installed.
### Featurecloud CLI
```
mkdir fc-app-testing
cd fc-app-testing
git clone git@github.com:FeatureCloud/cli.git
cd cli
# requirements file is for pip
# remove '~' to fit conda
conda create --name cli --file requirements_conda.txt
# additional dependecies
conda install pyyaml scipy pando markdown
cd ..
```

### Controller
For UNIX systems download controller and start controller
```
mkdir controller
cd controller
wget https://featurecloud.ai/assets/scripts/start_controller.sh
bash start_controller.sh
cd ..
```

### FC PCA code
Clone this repository
```
git clone git@github.com:AnneHartebrodt/fc-federated-pca.git
cd fc-federated-pca
#build docker image
docker build . --tag=federated_pca_batch
# add python path 
cd ..
export PYTHONPATH=$(pwd)/fc-federated-pca
```

### Set up test environment with autogenerated toy data
```
seed=11
sites=4
test_out=app_test/$seed/$sites
bash fc-federated-pca/app/test/setup_test_environment.sh $(pwd)/controller/data/ $(pwd)/cli $(pwd)/fc-federated-pca/app/test $test_out $seed $sites
```
### Run the app
```
bash fc-federated-pca/app/test/test.sh $(pwd)/controller/data/ $(pwd)/cli $(pwd)/fc-federated-pca/app/test $test_out
```

### Generate the report
```
mkdir test-output/$seed/$sites
bash fc-federated-pca/app/test/generate_report.sh $(pwd)/controller/data/ $(pwd)/cli $(pwd)/fc-federated-pca/app/test $test_out $(pwd)/test-output/$seed/$sites $seed
```
